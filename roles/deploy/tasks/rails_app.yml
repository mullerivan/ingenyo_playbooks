# AGREGAR CREACION DE USUARIO

- name: Clone repositorio
  git: repo={{rails_git_repositorie}} dest={{rails_app_path}} accept_hostkey=yes
  sudo: false

- name: bundle install (install the rest of the gems)
  shell: /usr/local/rvm/wrappers/default/bundle
         chdir={{rails_app_path}}
  sudo: false

- copy: src=rails_nginx_conf dest=/etc/nginx/sites-available/{{rails_app_name}}

- file: src=/etc/nginx/sites-available/{{rails_app_name}}  dest=/etc/nginx/sites-enabled/{{rails_app_name}}  state=link

- lineinfile: dest=/etc/nginx/sites-available/{{rails_app_name}}  regexp="root my_app/public;" line="root {{rails_app_path}}/public;"
- lineinfile: dest=/etc/nginx/sites-available/{{rails_app_name}}  regexp="www.xxx.com" line="server_name {{rails_app_name_url}};"

- name: rake db:migrate
  shell: /usr/local/rvm/wrappers/default/rake db:migrate RAILS_ENV=production
         chdir={{rails_app_path}}
  sudo: false

- name: assets:precompile
  shell: /usr/local/rvm/wrappers/default/rake assets:precompile
         chdir={{rails_app_path}}
  sudo: false

- name: reload nginx
  shell: service nginx reload
  sudo: true